<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.land.modular.plan.mapper.LandPlanDao">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.land.modular.plan.entity.LandPlanInfoEntity">
        <id column="id" property="id" />
        <result column="land_code" property="landCode" />
        <result column="plan_type" property="planType" />
        <result column="plan_name" property="planName" />
        <result column="create_time" property="createTime" />
        <result column="update_time" property="updateTime" />
        <result column="create_user" property="createUser" />
        <result column="update_user" property="updateUser" />
        <result column="plan_start_time" property="planStartTime" />
        <result column="plan_end_time" property="planEndTime" />
        <result column="act_start_time" property="actStartTime" />
        <result column="act_end_time" property="actEndTime" />
        <result column="plan_area" property="planArea" />
        <result column="current_area" property="currentArea" />
        <result column="rem_area" property="remArea" />
        <result column="cur_status" property="curStatus" />
        <result column="cur_progress" property="curProgress" />
        <result column="reasons" property="reasons" />
        <result column="reasons_type" property="reasonsType" />
        <result column="village_name" property="villageName" />
        <result column="renewal_name" property="renewalName" />
        <result column="zone_name" property="zoneName" />
        <result column="plan_unit" property="planUnit" />
        <result column="act_unit" property="actUnit" />
        <result column="credit_code" property="creditCode" />
        <result column="occupy_area" property="occupyArea" />
        <result column="bus_name" property="busName" />
        <result column="located" property="located" />
        <result column="pre_year_tax" property="preYearTax" />
        <result column="up_year_tax" property="upYearTax" />
        <result column="is_plan_bus" property="isPlanBus" />
        <result column="bus_status" property="busStatus" />
        <result column="remark" property="remark" />
        <result column="plan_code" property="planCode" />
        <result column="create_user_name" property="createUserName" />
        <result column="use_status" property="useStatus" />
        <result column="dis_type" property="disType" />
        <result column="con_standard" property="conStandard" />
        <result column="dis_standard" property="disStandard" />
        <result column="county_code" property="countyCode" />
        <result column="county_name" property="countyName" />
        <result column="year" property="year" />
    </resultMap>

    <!-- 通用查询结果列 -->
    <sql id="Base_Column_List">
        t.id,t.land_code as landCode,t.plan_type as planType,t.plan_name as planName,plan_code as planCode,
    t.create_time as createTime,t.update_time as updateTime,t.create_user as createUser,t.update_user as updateUser,
    t.plan_start_time as planStartTime,t.plan_end_time  as planEndTime,t.create_user_name as createUserName,t.update_user_name as updateUserName,
    t.act_start_time as actStartTime,t.act_end_time as actEndTime,t.plan_area as planArea,t.county_code as countyCode,t.county_name as countyName,
    t.year as disYear,
    t.current_area as currentArea,t.rem_area as remArea,t.use_status as useStatus,t.dis_type as disType,t.con_standard as conStandard,t.dis_standard as disStandard,
    t.cur_status as curStatus,t.cur_progress as curProgress, t.reasons ,t.reasons_type as reasonsType,
    t.village_name as villageName,t.renewal_name as renewalName,t.zone_name as zoneName,t.plan_unit as planUnit,
    t.act_unit as actUnit,t.credit_code as creditCode,t.bus_name as busName,t.occupy_area as occupyArea,
    t.located ,t.pre_year_tax as preYearTax,t.up_year_tax as upYearTax,t.is_plan_bus as isPlanBus,t.bus_status as busStatus,t.remark
    </sql>
    <!-- 查询地块基本信息结果列 -->
    <sql id="Left_Column_List">
        d.XMC as xmc ,d.PQBH as pqbh,d.XMMC as xmmc,d.XZDM as xzdm,d.XZMC as xzmc,d.DKBH as dkbh,d.DKMJ as dkmj,d.DLDM as dldm,d.DLMC as dlmc,d.XLDM as xldm,
        d.XLMC xlmc,d.XZYT xzyt,
      d.XZRJL xzrjl,d.XZJZMD xzjzmd,d.GHYT ghyt,d.GHRJL ghrjl,
	d.GHJZMD ghjzmd,d.KFQL kfql,d.ZKFSX zkfsx,d.PQMJ pqmj,d.ZB  zb,d.category as category,
	d.land_status as landStatus,d.zbq,d.qymc,d.bdcqzsh,d.crsj,d.htrjl,d.httzqd,d.htmjss,d.hydm,d.hymc,d.rjljsz,d.dkrjl,d.rjlfz,d.tzqdfz,d.tzqdjs,d.dktzqd,d.ssccljs,
	d.dkssccl,d.dksscclfz,d.bmysfz,d.zfysfz,d.zhdf,d.xdm,d.year,d.cbhs,d.tdgy,d.xyqd,d.ghtjbg,d.cxrd,d.tsfabz,d.tscxzm,d.xmlx,d.xmsg,d.xmys,d.xmzbsy,d.jbqk,d.dktj,
	d.sczkfjz,d.sc_status as scStatus
    </sql>

    <select id="selectListByPage" resultType="java.util.Map">
        select
        <include refid="Base_Column_List"/>,
        <include refid="Left_Column_List"/>
        from land_plan_info t
        left join land_detail_info d on t.land_code=d.land_code
        where 1=1
        <if test="beginTime != null and beginTime != ''">
            and t.create_time >= CONCAT(#{beginTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != ''">
            and t.create_time &lt;=CONCAT(#{endTime},' 23:59:59')
        </if>
        <if test="vo.planType != null and vo.planType != ''">
            and t.plan_type = #{vo.planType}
        </if>
        <if test="vo.planName != null and vo.planName != ''">
            and t.plan_name like CONCAT('%',#{vo.planName},'%')
        </if>
        <if test="vo.busName != null and vo.busName != ''">
            and t.bus_name like CONCAT('%',#{vo.busName},'%')
        </if>
        <if test="vo.villageName != null and vo.villageName != ''">
            and t.village_name like CONCAT('%',#{vo.villageName},'%')
        </if>
        <if test="vo.renewalName != null and vo.renewalName != ''">
            and t.renewal_name like CONCAT('%',#{vo.renewalName},'%')
        </if>
        <if test="vo.zoneName != null and vo.zoneName != ''">
            and t.zone_name like CONCAT('%',#{zoneName},'%')
        </if>
        <if test="vo.busName != null and vo.xmmc != ''">
            and d.XMMC like CONCAT('%',#{vo.xmmc},'%')
        </if>
        <if test="vo.countyCode != null and vo.countyCode != ''">
            and t.county_code = #{vo.countyCode}
        </if>
        <if test="vo.countyName != null and vo.countyName != ''">
            and find_in_set(t.county_name,#{vo.countyName}) > 0
        </if>
        order by t.create_time desc
    </select>

    <select id="getDetailById" resultType="com.land.modular.plan.vo.LandPlanInfoVo">
        select
        <include refid="Base_Column_List"/>,
        <include refid="Left_Column_List"/>
        from land_plan_info t
        left join land_detail_info d on t.land_code=d.land_code
        where t.id = #{id}
    </select>

    <select id="diffStaList" resultType="java.util.Map">
        select year,reasonsType,count(1) as landNum from(
        select left(t.plan_start_time,4) as year,t.reasons_type as reasonsType
        from land_plan_info t
            left join land_detail_info b
        on t.land_code=b.land_code
        where 1=1
        <if test="beginTime != null and beginTime != ''">
            and t.create_time >= CONCAT(#{beginTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != ''">
            and t.create_time &lt;=CONCAT(#{endTime},' 23:59:59')
        </if>
        <if test="vo.xdm != null and vo.xdm != ''">
            and b.xdm = #{vo.xdm}
        </if>
        ) t
        group by year,reasonsType
    </select>

    <select id="selectByName" resultMap="BaseResultMap">
        select
        <include refid="Base_Column_List"/>
        from land_plan_info t
        where t.bus_name = #{busName}
    </select>

    <select id="inbusList" resultType="java.util.Map">
        select county_name as xmc, year,totalArea,finishArea,(finishArea/totalArea) * 100 as comratio from (
            select county_name, year,sum(COALESCE(CAST(occupy_area AS DECIMAL(20, 4)), 0)) as totalArea,sum(COALESCE(CAST(current_area AS DECIMAL(20, 4)), 0)) as finishArea
        from land_plan_info t
        where t.plan_type = '1'
            <if test="beginTime != null and beginTime != ''">
                and t.create_time >= CONCAT(#{beginTime},' 00:00:00')
            </if>
            <if test="endTime != null and endTime != ''">
                and t.create_time &lt;=CONCAT(#{endTime},' 23:59:59')
            </if>
            <if test="vo.xdm != null and vo.xdm != ''">
                and t.county_code = #{vo.xdm}
            </if>
            group by t.county_name, t.year
            ) t
    </select>

    <select id="inbusListExport" resultType="com.land.modular.statistics.vo.InBusinessVo">
        select county_name as xmc, year,totalArea,finishArea,(finishArea/totalArea) * 100 as comratio from (
        select county_name, year,sum(COALESCE(occupy_area, 0)) as totalArea,sum(COALESCE(current_area, 0)) as finishArea from land_plan_info t
        where plan_type = '1'
        <if test="beginTime != null and beginTime != ''">
            and t.create_time >= CONCAT(#{beginTime},' 00:00:00')
        </if>
        <if test="endTime != null and endTime != ''">
            and t.create_time &lt;=CONCAT(#{endTime},' 23:59:59')
        </if>
        <if test="vo.xdm != null and vo.xdm != ''">
            and t.county_code = #{vo.xdm}
        </if>
        group by county_name, year
        ) t
    </select>
</mapper>
